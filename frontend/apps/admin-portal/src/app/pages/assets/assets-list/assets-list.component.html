<p-toast></p-toast>
<p-confirmDialog></p-confirmDialog>

<div class="assets-list-container">
  <p-card>
    <ng-template pTemplate="header">
      <div class="header-container">
        <h2 class="title">{{ 'assets.title' | translate }}</h2>
        <div class="header-actions">
          <span class="p-input-icon-left search-input">
            <i class="pi pi-search"></i>
            <input type="text" pInputText [placeholder]="'common.searchPlaceholder' | translate" />
          </span>
          <p-button
            [label]="'assets.createAsset' | translate"
            icon="pi pi-plus"
            severity="success"
            (onClick)="openCreateDialog()">
          </p-button>
        </div>
      </div>
    </ng-template>

    <p-table
      [value]="assets().items"
      [loading]="loading()"
      [paginator]="true"
      [rows]="pageSize()"
      [totalRecords]="assets().totalCount"
      [lazy]="true"
      (onLazyLoad)="loadAssets($event)"
      responsiveLayout="scroll"
      styleClass="p-datatable-striped"
    >
      <ng-template pTemplate="header">
        <tr>
          <th pSortableColumn="code">{{ 'assets.assetCode' | translate }} <p-sortIcon field="code"></p-sortIcon></th>
          <th pSortableColumn="name">{{ 'assets.assetName' | translate }} <p-sortIcon field="name"></p-sortIcon></th>
          <th>{{ 'assets.category' | translate }}</th>
          <th pSortableColumn="purchasePrice">{{ 'assets.purchasePrice' | translate }} <p-sortIcon field="purchasePrice"></p-sortIcon></th>
          <th>{{ 'assets.depreciationRate' | translate }}</th>
          <th>{{ 'assets.purchaseDate' | translate }}</th>
          <th pSortableColumn="status">{{ 'common.status' | translate }} <p-sortIcon field="status"></p-sortIcon></th>
          <th style="width: 120px;">{{ 'common.actions' | translate }}</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-asset>
        <tr>
          <td class="font-weight-bold">{{ asset.code }}</td>
          <td>{{ asset.name }}</td>
          <td>{{ asset.categoryName }}</td>
          <td class="text-right">{{ asset.purchasePrice | number:'1.0-2' }} VND</td>
          <td class="text-right">{{ asset.depreciationRate | number:'1.0-2' }}%</td>
          <td>{{ asset.purchaseDate | date:'dd/MM/yyyy' }}</td>
          <td>
            <p-tag [value]="getStatusLabel(asset.status)" [severity]="getStatusSeverity(asset.status)"></p-tag>
          </td>
          <td>
            <div class="action-buttons">
              <p-button
                icon="pi pi-pencil"
                [text]="true"
                severity="info"
                [pTooltip]="'common.edit' | translate"
                tooltipPosition="top"
                (onClick)="openEditDialog(asset.id)"
              ></p-button>
              <p-button
                icon="pi pi-trash"
                [text]="true"
                severity="danger"
                [pTooltip]="'common.delete' | translate"
                tooltipPosition="top"
                (onClick)="deleteAsset(asset.id, asset.name)"
              ></p-button>
            </div>
          </td>
        </tr>
      </ng-template>

      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="8" class="text-center">
            <i class="pi pi-inbox"></i>
            {{ 'assets.noAssetsFound' | translate }}
          </td>
        </tr>
      </ng-template>

      <ng-template pTemplate="loadingbody">
        <tr>
          <td colspan="8">
            <p-skeleton></p-skeleton>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </p-card>
</div>

<app-asset-dialog
  [(visible)]="showDialog"
  [mode]="dialogMode"
  [assetId]="selectedAssetId"
  (saved)="onAssetSaved()">
</app-asset-dialog>
